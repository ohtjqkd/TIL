# 클린코드 & 리팩토링 & 시큐어코딩

## 클린코드

클린코드의 핵심 키워드는 __가독성__, 클린코드란 가독성이 높은 코드를 말함
그렇다면 어떤 코드가 가독성이 높다고 얘기할 수 있을까?

1. 네이밍
- 변수, 클래스, 메소드에 의도가 분명한 이름을 사용
    ```
    int elaspedTimeInDays;
    int daysSinceCreation;
    int fileAgeInDyas;
    ```
    위 예시를 보면서 중요한 것을 깨닫게 됨... 개발자는 영어도 공부해야 한다는 점..  

2. 주석

    __코드를 보는 사람이 코드를 작성한 사람만큼 잘 이해할 수 있도록 도와야 함__

    주석은 반드시 작성해야 할 이유가 있는 경우에만 작성  
    주석을 너무 난발하게 되면 오히려 지저분해지는 경우가 발생할 수도 있음

3. 꾸미기(Asethetics)

    __보기 좋게 배치하고 꾸밈__
    규칙적인 들여쓰기와 줄바꿈으로 가독성을 높임
    메소드를 이용해 불규픽한 중복 코드를 제거
    클래스 전체를 하나의 그룹이라고 생각하지 말고, 그 안에서도 여러 그룹으로 나누는 것이 읽기에 좋음

4. 흐름제어 만들기(Making control flow easy to read)
    - 왼쪽에는 변수를, 오른쪽에는 상수를 두고 비교
    ```
    if (length >= 10)
    while (bytes_received < byte_expected)
    ```
    - 부적이 아닌 긍정을 다루자
    ```
    if (a == b) {

    } else {

    }
    ```
    * 긍정을 다루는 것이 가독성은 좋지만 로직상 어쩔 수 없을 때는 상관 없을 듯?

5. 착한 함수(Function)  
    __함수는 가급적 작게, 한번에 하나의 작업만 수행하도록 작성__

그 밖에 원칙들
- 오류가 없어야 함
- 중복이 없어야 함
- 의존성을 최대한 줄여야 함
- 클래스 혹은 메소드가 한가지 일만 처리해야 함
- Fllow Standard Conventions: coding 표준, 아키텍쳐 표준 및 설계 가이드를 준수
- Keep it Simple, Stupid(KISS): 단순한 것이 효율적이며, 복잡함을 최소하
- Boy Scout Rule: 캠핑장을 떠나기 전에 원래보다 깨끗하게 해야 한다.(참조되거나 수정되는 코드는 원래보다 clean하게 해야 함)
- Root Cause Analysis: 항상 근본적인 원인을 찾아라. 그렇지 않으면 반복될 것이다.
- Do Not Multiple Languages in One Source File: 하나의 파일은 하나의 언어로 작성하라.
- 객체지향의 SOLID 원칙
- Command와 Query의 분리
- 오류코드 보다는 예외를 활용

### 코드가 클린해야하는 이유
일반적으로 기존 코드를 변경하고자 할 떄, 해석하는 시간과 수정하는 비율이 10:1이라고 함. 코드 해석의 시간 비용이 높음. 또한 대부분의 결함이 기존 코드를 수정하는 동안에 발생한다고 함. 이런 오류 위험성을 최소화하는 방법이 코드를 이해하기 쉽게 작성하는 것, 즉 클린 코드로 작성해야하는 이유

samsungsds insight report: (https://www.samsungsds.com/kr/insights/cleancode-0823.html)


## 리팩토링  
__레거시 코드(테스트가 불가능하거나 어려운 코드)를 클린 코드로 만드는 방법__  
코드리뷰를 통해 냄새나는 코드를 발견하면, 리팩토링을 통해 점진적으로 개선해나간다.
단 중요한 것은 리팩토링보다 코드가 올바르게 작동하는 것이 우선이라는 점

리팩토링은 성능의 향상이 목적은 아니다. 코드를 신속하게 개발할 수 있게 만들어주고, 코드 품질을 좋게 만들어주기 위해 하는 행위

코드가 이해하기 쉽고, 수정이 쉬우면 개발 속도가 증가함

__리팩토링 대상__  
- 메소드 정리 : 그룹으로 묶을 수 있는 코드, 수식을 메소드로 변경함
- 객체 간의 기능 이동 : 메소드 기능에 따른 위치 변경, 클래스 기능을 명확히 구분
- 데이터 구성 : 캡슐화 기법을 적용해 데이터 접근 관리
- 조건문 단순화 : 조건 논리를 단순하고 명확하게 작성
- 메소드 호출 단순화 : 메소드 이름이나 목적이 맞지 않을 때 변경
- 클래스 및 메소드 일반화 : 동일 기능 메소드가 여러개 있으면 수퍼클래스로 이동

__코드 인스펙션__  
작성한 개발 소스 코드를 분석하여 개발 표준에 위배되었거나 잘못 작성된 부분을 수정하는 작업
1. Planning: 계획 수립
2. Overview: 교육과 역할 정의
3. Preparation: 인스펙션을 위한 인터뷰, 산출물, 도구 준비
4. Meeting: 검토 회의로 각자 역할을 맡아 임무 수행
5. Rework: 발견한 결함을 수정하고 재검토 필요한지 여부 결정
6. Follow-up: 보고된 결함 및 이슈가 수정되었는지 확ㅇ니하고 시정조치 이행

절차에 대한 참고 자료: [도리의 디지털라이프](http://blog.skby.net/%EC%86%8C%ED%94%84%ED%8A%B8%EC%9B%A8%EC%96%B4-%EB%A6%AC%ED%8C%A9%ED%86%A0%EB%A7%81-refactoring/)

## 시큐어 코딩
__소프트웨어를 개발함에 있어 개발자의 실수, 논리적 오류 등으로 인해 SW에 내포될 수 있는 보안취약점을 배제하기 위한 코딩 기법을 뜻함__  

### 시큐어 코딩 가이드

시큐어 코딩은 개발단계에서 적용되기 때문에 개발자의 코딩 작업이 핵심 대상이 된다. 하지만 취약점을 모두 고려하는 프로그래밍은 어렵기 때문에 국내에서는 행정안전부에서 시큐어 코딩에 대한 법규가 제정, 시행되어 그 기준을 제시함

- 시큐어 코딩의 7가지 유형
    1. 입력데이터 검증 및 표현  
    폼 양식의 입력란에 입력되는 데이터로 인해 발생하는 문제를 예방하기 위해 점검하는 보안 항목을 의미함, 주로 SQL Injection 공격을 막기 위한 코딩 방법
    2. 보안 기능  
    인증, 접근제어, 기밀성, 암호화 등을 올바르게 구현하기 위한 보안 항목. 주로 암호와 같이 중요한 정보를 암호화 없이 저장하거나 프로그램 내부에 하드코딩되어 노출 위험성이 있는 경우, 인증과 권한 관리를 부적절하게 구현할 시 발생하는 문제가 있음.
    3. 시간 및 상태  
    병렬 시스템이나 하나 이상의 프로세스가 동작하는 환경에서 시간 및 상태를 부적절하게 관리하여 발생할 수 있는 보안 약점을 해결해야함. 공유자원 관리에 대한 항목인듯 (ex. 레이스 컨디션, 무한 루프)
    4. 에러 처리  
    에러를 처리 방식이 부적절하거나 누락되어 발생하는 보안 항목. 편의성을 위해 에러 메시지를 화면에 출력하는 경우 공격자의 행위를 돕는 꼴임. 에러 처리는 가능한 최소한의 정보만 담고 있어야 하며, 광범위한 예외 처리보다는 구체적인 예외처리를 통해 보안 공격을 사전에 방어하는 것이 중요함
    5. 코드 오류  
    코드 오류는 구현 단계에서 개발자의 실수나 지식 미달로 인한 오류를 예방하기 위한 점검 항목. 주로 형변환, 자원 반환, NullPointer 참조가 이에 해당함. 본인만의 보안 코딩 규칙을 만들어야 함.
    6. 캡슐화  
    객체의 필드를 은닉하여 외부에서의 잘못된 사용을 방지하는 것을 의미. 그러나 불충분한 캡슐화는 오히려 보안 취약점으로 작용하는 경우도 있음.
    7. API 오용  
    취약한 API를 사용함으로써 생기는 보안 문제점을 해결해야함
    ex) DNS Lookup 명령어를 통해 얻은 도메인명을 가지고 유효성을 판단하는 경우 DNS 위변조시에는 잘못된 도메인명에 의해서 트래픽이 공격자를 경유하게 될 수도 있고, 공격자를 목적지로 가지게 되는 경우도 있음
    (https://it-license.tistory.com/93)

시큐어코딩 가이드 / 행정자치부(KISA) / 2016.03 https://www.kisa.or.kr/2060207